# modules/docker-sqlserver.nix
{ config, pkgs, lib, ... }:

{
  systemd.services.docker-sqlserver = {
    description = "Microsoft SQL Server Docker container";
    after = [ "docker.service" "network-online.target" ];
    requires = [ "docker.service" ];

    serviceConfig = {
      ExecStart = ''
        ${pkgs.docker}/bin/docker run \
          --name sqlserver \
          -e ACCEPT_EULA=Y \
          -e SA_PASSWORD=YourStrong@Pass123 \
          -p 1433:1433 \
          -v /var/lib/sqlserver/data:/var/opt/mssql \
          --restart=always \
          mcr.microsoft.com/mssql/server:2022-latest
      '';
      ExecStop = "${pkgs.docker}/bin/docker stop sqlserver";
      ExecStopPost = "${pkgs.docker}/bin/docker rm sqlserver";
      Restart = "always";
    };

    wantedBy = [ "multi-user.target" ];
  };
}

